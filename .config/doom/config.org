#+Title: Emacs Config

** Keys for Mac
#+begin_src emacs-lisp  :tangle yes
  (setq mac-command-modifier       'meta
        mac-option-modifier        'meta
        mac-control-modifier       'control
        mac-right-option-modifier     'meta
        mac-right-control-modifier  'control)
#+end_src

#+RESULTS:
: control

** Window transparency
#+begin_src emacs-lisp :tangle yes

(set-frame-parameter nil 'alpha-background 50)
#+end_src

#+RESULTS:

** Tab completion
#+begin_src emacs-lisp :tangle yes

(use-package! company
  :bind
  (:map company-active-map
        ("<tab>" . company-complete-selection))
  :custom
  (company-minimum-prefix-length 1)
  (company-idl-delay 0.0))



#+end_src

#+RESULTS:
: company-indent-or-complete-common

** My Info:
#+begin_src emacs-lisp :tangle yes
(setq user-full-name "Richard Cool"
      user-mail-address "richardjcool@gmail.com")
#+end_src

#+RESULTS:
: richardjcool@gmail.com


** Move to trash to delete
#+begin_src emacs-lisp :tangle yes
(setq-default delete-by-moving-to-trash t
              trash-directory "~/.local/share/Trash/files/")
#+end_src

#+RESULTS:
: ~/.local/share/Trash/files/

** Window
*** Take new window space from all other windows (not just current)
#+begin_src emacs-lisp :tangle yes
(setq-default window-combination-resize t)
#+end_src

*** Show the list of buffers when splitting
#+begin_src emacs-lisp :tangle yes
;; (defadvice! prompt-for-buffer (&rest _)
;;   :after '(evil-window-split evil-window-vsplit)
;;   (counsel-ibuffer))
#+end_src

** Better undo
#+begin_src emacs-lisp :tangle yes
(after! undo-fu
  (setq undo-limit 10000000 ;; 1MB
        undo-strong-limit 100000000 ;;100MB
        undo-outer-limit 1000000000) ;; 1GB
(setq undo-fu-allow-undo-in-region t
      undo-fu-ignore-keyboard-quit t))
;;Evil undo
(after! evil
  (setq evil-want-fine-undo t))
#+end_src

** Recent files
Files edited when using =emacsclient= are not stored by =recentf=.  So emacs forgets about your most recently opened files. A quick fix is to hook into the /recentf-save-list/ command to the /delete-frame-functions/ and /delete-terminal-functions/ which get execute each time a frame/terminal is deleted.
#+begin_src emacs-lisp :tangle yes
(when (daemonp)
  (add-hook! '(delete-frame-functions delete-terminal-functions)
             (let ((inhibit-message t))
               (recentf-save-list)
               (savehist-save))))
#+end_src
** Font
#+begin_src emacs-lisp :tangle yes
(setq doom-font (font-spec :family "PragmataProMonoLiga Nerd Font" :size 18)
      doom-big-font (font-spec :family "Iosevka Aile" :size 30)
      doom-variable-pitch-font (font-spec :family "Iosevka Aile" :size 18)
      doom-unicode-font (font-spec :family "Spleen 32x64" :size 18)
      doom-serif-font (font-spec :family "Iosevka Aile" :size 18)

      )


(custom-set-faces!
  '(font-lock-comment-face :slant italic)
  '(font-lock-keyword-face :slant italic))

#+end_src

#+RESULTS:
| doom--customize-themes-h-103 | doom--customize-themes-h-104 | doom--customize-themes-h-105 |


** COMMENT Theme
#+begin_src emacs-lisp :tangle yes
(use-package! modus-themes
  :init
  (setq modus-themes-hl-line '(intense)
        modus-themes-subtle-line-numbers nil
        modus-themes-region '(no-extend bg-only)
        modus-themes-variable-pitch-ui nil
        modus-themes-fringes 'intense
        modus-themes-diffs nil
        modus-themes-italic-constructs t
        modus-themes-bold-constructs  t
        modus-themes-prompts '( bold intense italic)
        modus-themes-intense-mouseovers t
        modus-themes-paren-match '(bold intense)
        modus-themes-syntax '( yellow-comments)
        modus-themes-links '(neutral-underline background)
        modus-themes-mode-line '(moody borderless accented 4 1)
        modus-themes-org-blocks 'gray-background
        modus-themes-markup '(intense background)
        modus-themes-mail-citations 'intensep
        modus-themes-lang-checkers '(background))

(defun +modus-themes-tweak-packages ()
  (modus-themes-with-colors
    (set-face-attribute 'cursor nil :background (modus-themes-color 'blue))
  (set-face-attribute 'font-lock-type-face nil :foreground (modus-themes-color 'magenta-alt))
  (custom-set-faces
   `(evil-mc-cursor-default-face ((,class :background ,magenta-intense-bg)))
   ;; Tweak gutters
   `(git-gutter-fr:added ((,class :foreground ,green-fringe-bg)))
   `(git-gutter-fr:deleted ((,class :foreground ,red-fringe-bg)))
   `(git-gutter-fr:modified ((,class :foreground ,yellow-fringe-bg)))
   ;;Modeline
   `(doom-modeline-evil-normal-state ((,class :foreground ,greeen-alt-other)))
   `(doom-modeline-evil-insert-state ((,class :foreground ,red-alt-other)))
   `(doom-modeline-evil-visual-state ((,class :foreground ,magenta-alt)))
   `(doom-modeline-evil-operator-state ((,class :foreground ,blue-alt)))
   `(doom-modeline-evil-motion-state ((,class :foreground ,blue-alt-other)))
   `(doom-modeline-evil-replace-state ((,class :foreground ,yellow-alt)))
   ;; Tweak diff-hl-mode
   `(diff-hl-insert ((,class :foreground ,green-fringe-bg)))
   `(diff-hl-delete ((,class :foreground ,red-fringe-bg)))
   `(diff-hl-change ((,class :foreground ,yellow-fringe-bg)))
   ;; Tweek solaire mode
   `(solaire-default-face ((,class :inherit default :background :foreground ,fg-dim)))
   `(solaire-line-number-face ((,class :inherit solaire-default-face :foreground ,fg-unfocused)))
   `(solaire-hl-line-face ((,class :inherit :background ,bg-active)))
   `(solaire-org-hide-face ((,class :inherit :background ,bg-alt :foreground ,bg_alt)))
   `(fill-column-indicator ((,class :height 0.3 :background ,bg-inactive :foreground ,bg-inactive))))))

(add-hook 'modus-themes-after-load-theme-hook #'+modus-themes-tweak-packages)

:config
(map! :leader
      :prefix "t"
      :desc "Toggle modus theme" "m" #'modus-themes-toggle)






(load-theme 'modus-vivendi t)

                )

#+end_src

#+RESULTS:
: t

** Copilot
#+begin_src emacs-lisp :tangle yes
;; accept completion from copilot and fallback to company
(use-package! copilot
  :hook (prog-mode . copilot-mode)
  :bind (("C-TAB" . 'copilot-accept-completion-by-word)
         ("C-<tab>" . 'copilot-accept-completion-by-word)
         :map copilot-completion-map
         ("<tab>" . 'copilot-accept-completion)
         ("TAB" . 'copilot-accept-completion)))
         #+END_SRC

         #+RESULTS:
         : copilot-accept-completion


* Turn on rainbow mode
#+begin_src emacs-lisp :tangle yes
(define-globalized-minor-mode global-rainbow-mode rainbow-mode
  (lambda ()
    (when (not (memq major-mode
                (list 'org-agenda-mode)))
     (rainbow-mode 1))))
(global-rainbow-mode 1 )
#+end_src

#+RESULTS:
: t

* line numbers
#+begin_src emacs-lisp :tangle yes
(global-display-line-numbers-mode 1)
(setq display-line-numbers-type 'relative)
#+end_src

#+RESULTS:
: relative

* tramp
#+begin_src emacs-lisp :tangle yes
(setq tramp-default-method "ssh")

#+end_src

#+RESULTS:
: ssh

* auto-tangle
#+begin_src emacs-lisp :tangle yes
 (use-package! org-auto-mode
   :defer t
   :hook (org-mode . org-auto-tangle-mode)
   :config
   (setq org-auto-tangle-default t))
#+end_src

#+RESULTS:


* COMMENT Ivy Posframe
#+begin_src emacs-lisp :tangle yes
(setq ivy-posframe-display-functions-alist
      '((swiper                         . ivy-posframe-display-at-point)
     (complete-symbol            . ivy-posframe-display-at-point)
        (counsel-M-x                . ivy-display-function-fallback)
        (counsel-esh-history        . ivy-posframe-display-at-window-center)
        (counsel-describe-function  . ivy-display-function-fallback)
        (counsel-describe-variable  . ivy-display-function-fallback)
        (counsel-find-file          . ivy-display-function-fallback)
        (counsel-recentf            . ivy-display-function-fallback)
        (counsel-register           . ivy-posframe-display-at-frame-bottom-window-center)
        (dmenu                      . ivy-posframe-display-at-frame-top-center)
        (nil                        . ivy-posframe-display))
      ivy-posframe-height-alist
      '((swiper . 20)
        (dmenu . 20)
        (t . 10)))
(setq ivy-posframe-border-width 0)
(ivy-posframe-mode 1)
#+end_src

#+RESULTS:
: t

#+RESULTS:
: t

* Org
   #+begin_src emacs-lisp :tangle yes
(after! org

  ;; TODO: extract org-directory into noweb reference so it can be used in all the places
  (setq org-directory "~/org"
        org-agenda-files '(
                           "~/org/todo.org"
                           "~/org/agenda.org"
                           )
        +org-capture-todo-file "inbox.org")
  (setq org-todo-keywords '((sequence "TODO(t)" "WAIT(w)" "HOLD(h)" "|" "DONE(d!)" "CANCELLED(c!)")))

  (setq org-todo-keyword-faces '(("TODO" . (:foreground "#7bc275" :weight normal))
                                 ("WAIT" . (:foreground "orange" :weight normal))
                                 ("HOLD" . (:inherit warning :weight normal))))


  (org-babel-do-load-languages
   'org-babel-load-languages
   '(
     (python . t)
     (shell . t)
     (js . t)
     (lua . t)
     (sql . t)
     ))
  (setq python-shell-completion-native-enable nil)
  (setq org-src-window-setup 'current-window)

   (defun org-babel-execute:typescript (body params)
    (let ((org-babel-js-cmd "npx ts-node < "))
      (org-babel-execute:js body params)))
(setq org-src-fontify-natively t
      org-src-tab-acts-natively t
      org-src-window-setup 'current-window)

  (setq org-capture-templates
        '(
          ("t" "todo" entry (file +org-capture-todo-file) "* TODO %?")
          ("n" "node" entry (file +org-capture-todo-file) "* Note: ")
          ("p" "process email" entry (file +org-capture-todo-file)
           "* TODO %? %:fromname: %a")
          )))

(map!
 :leader
 :prefix "m"
 :map 'org-src-mode-map
 (:desc "Accept SRC Edits"
 :nmv "J" #'org-edit-src-exit)
 (:desc "Abort SRC Edits"
 :nmv "X" #'org-edit-src-abort))
#+end_src

#+RESULTS:
: org-edit-src-abort

* Set HUGO base directory
#+begin_src emacs-lisp :tangle yes

(setq org-hugo-base-dir "~/org/markdown")

#+end_src

#+RESULTS:
: ~/org/markdown

** Turn on beacon
#+begin_src emacs-lisp :tangle yes
  (use-package! beacon
    :config
    (beacon-mode +1))
#+end_src

#+RESULTS:
: t

** Line Highlighting and Fringe
#+BEGIN_SRC emacs-lisp  :tangle yes
  ;; Turn on line highlithting for current line
  (hl-line-mode 1)
  ;; Add some margins
  (set-fringe-mode 10)
#+END_SRC

#+RESULTS:
: ((buffer-predicate . doom-buffer-frame-predicate) (right-divider-width . 1) (bottom-divider-width . 1) (menu-bar-lines . 1) (vertical-scroll-bars) (tool-bar-lines . 0) (left-fringe . 10) (right-fringe . 10))

** Manage how new windows are placed
#+begin_src emacs-lisp :tangle yes
    (winner-mode +1)
  (setq display-buffer-base-action
    '((display-buffer-reuse-window
       display-buffer-reuse-mode-window
       display-buffer-same-window
       display-buffer-in-previous-window)))
#+end_src

#+RESULTS:
| display-buffer-reuse-window | display-buffer-reuse-mode-window | display-buffer-same-window | display-buffer-in-previous-window |

* Customize mode line
#+begin_src emacs-lisp :tangle yes
(after! doom-modeline
    (setq
     doom-modeline-hud t
     doom-modeline-minor-modes nil
          doom-modeline-height 25))
#+end_src

#+RESULTS:
: 25

** Mixed Pitch
A better verson of variable pitch.

#+begin_src emacs-lisp :tangle yes
  (use-package! mixed-pitch
    :defer t
    :config
    (setq mixed-pitch-set-height nil)
    (dolist (face '(org-date org-priority org-tag org-special-keyword))
      (add-to-list 'mixed-pitch-fixed-pitch-faces face))
   )
#+end_src

#+RESULTS:

** Quickrun
#+begin_src emacs-lisp :tangle yes
  (use-package! quickrun
    :defer t
    :general
    (general-def
     :states 'normal
     :prefix "SPC"
     :keymaps 'quickrun--mode-map
     "cq" '(nil :which-key "quickrun")
     "cqq" '(quit-window :which-key "Quit")
     "cqr" '(quickrun :which-key "Run")
     "cqR" '(quickrun-region :which-key "Run Region")
     "cqa" '(quickrun-with-arg :which-key "Run with [A]rgs")
     "cqm" '(quickrun-autorun-mode :which-key "Toggle autorun mode")
     "cqs" '(quickrun-select :which-key "Select backend")
     "cq"  '(nil :which-key "quickrun")
     "cqq" '(quit-window :which-key "Quit")
     "cqr" '(quickrun :which-key "Run")
     "cqR" '(quickrun-region :which-key "Run Region")
     "cqa" '(quickrun-with-arg :which-key "Run with [A]rgs")
     "cqm" '(quickrun-autorun-mode :which-key "Toggle autorun mode")
     "cqs" '(quickrun-select :which-key "Select backend")
 ))
#+end_src

#+RESULTS:

** Auto-revert changed files
#+begin_src emacs-lisp  :tangle yesl
  (setq global-auto-revert-non-file-buffers t)
(global-auto-revert-mode 1)
#+end_src

#+RESULTS:
: t


* Treesitter
#+begin_src emacs-lisp :tangle yes
(after! tree-sitter
(add-to-list 'tree-sitter-major-mode-language-alist '(tsx-mode . tsx))
)
#+end_src

#+RESULTS:

* LSP-UI
#+begin_src emacs-lisp :tangle yes
(use-package! lsp-ui
  :after lsp
  :hook ((lsp-mode . lsp-ui-mode)
         (lsp-mode . lsp-ui-sideline-mode))
  :config
  (setq lsp-ui-sideline-show-hover t)
  (setq lsp-ui-doc-position 'top)
  )
#+end_src

#+RESULTS:

*TSX Mode
#+begin_src emacs-lisp :tangle yes
(use-package! tsi
  :hook ((web-mode-hook . tsi-typescript-mode)
         (typescript-mode-hook . tsi-typescript-mode)
         (tsx-mode-hook . tsi-typescript-mode)
          (json-mode-hook . tsi-typescript-mode)
          (css-mode-hook . tsi-css-mode)
          (scss-mode-hook . tsi-scss-mode))
  :config
  (require 'tsi-css)
  (require 'tsi-json)
  (require 'tsi-typescript)

)

(use-package! tsx-mode

  :hook (tsx-mode . lsp-deferred)
  :config
  (add-to-list 'auto-mode-alist '("\\.[jt]sx?\\'" . tsx-mode))

(map!
 :leader
 :prefix "m"
 :map 'general-override-mode-map
 (:desc "Toggle All Nodes"
  :nmv #'tsx-mode-fold-toggle-all-nodes)
 (:desc "Toggle Coverage"
        :nmv #'tsx-mode-coverage-toggle)
 (:desc "Toggle Node"
        :nvm #'tsx-mode-fold-toggle-node)
)
)
#+end_src

#+RESULTS:
| lsp-deferred |

* Format on Save
#+begin_src emacs-lisp :tangle yes
(use-package! apheleia
  :config
  (apheleia-global-mode +1))

#+end_src

#+RESULTS:
: t
* Keybinds with Hercules
#+end_src

#+RESULTS:
: rc/add-keymap-to-hercules

** LSP
#+begin_src emacs-lisp :tangle yes
(general-def
  :prefix-map 'rc/lsp-map
"d"   #'lsp-find-declaration
"D"   #'lsp-ui-peek-find-definitions
"R"   #'lsp-ui-peek-find-references
"i"   #'lsp-ui-peek-find-implementation
"t"   #'lsp-find-type-definition
"s"   #'lsp-signature-help
"o"   #'lsp-describe-thing-at-point
"r"   #'lsp-rename

"f"   #'lsp-format-buffer
"m"   #'lsp-ui-imenu
"x"   #'lsp-execute-code-action
)
(hercules-def
:toggle-funs #'rc/lsp-map-mode
:keymap 'rc/lsp-map
:transient t)
(map!
 :leader
 :prefix "H"
 :desc "LSP"
 :nm "L" #'lsp-map-mode
 )
#+end_src

#+RESULTS:
: lsp-map-mode

** Flycheck
#+begin_src emacs-lisp :tangle yes
(general-def
:prefix-map 'rc/flycheck-map
   "f" #'flycheck-error-list-set-filter
   "j" #'flycheck-next-error
   "k" #'flycheck-previous-error
)
(hercules-def
 :toggle-funs #'rc/flycheck-mode
 :keymap 'rc/flycheck-map
 :transient t)
(map!
 :leader
 :prefix "H"
 :desc "Flycheck"
 :nm "f" #'rc/flycheck-mode)
#+end_src

#+RESULTS:
: rc/flycheck-mode

** Avy
#+begin_src emacs-lisp :tangle yes
(general-def
  :prefix-map 'rc/avy-map
"c" #'avy-goto-char-timer
"C" #'avy-goto-char
"w" #'avy-goto-word-1
"W" #'avy-goto-word-0
"l" #'avy-goto-line
"L" #'avy-goto-end-of-line
"m" #'avy-move-line
"M" #'avy-move-region
"k" #'avy-kill-whole-line
"K" #'avy-kill-region
"y" #'avy-copy-line
"Y" #'avy-copy-region
)
(hercules-def
 :toggle-funs #'rc/avy-mode
 :keymap 'rc/avy-map
 :transient t
)
(map!
 :leader
 :prefix "H"
 :desc "Avy"
 :nm "a" #'rc/avi-mode)
#+end_src

#+RESULTS:
: rc/avi-mode

** YasNippet
#+begin_src emacs-lisp :tangle yes
;; (general-def
;;   :prefix-map 'rc/snippet-map
;;   "d" #'yas-load-directory
;;   "e" #'yas-activate-extra-mode
;;   "i" #'yas-insert-snippet
;;   "f" #'yas-visit-snippet-file
;;   "n" #'yas-new-snippet
;;   "t" #'yas-tryout-snippet
;;   "l" #'yas-describe-tables
;;   "g" #'yas/global-mode
;;   "m" #'yas/minor-mode
;;   "a" #'yas-reload-all
;; )
;; (hercules-def
;;  :toggle-funs #'rc/snippet-mode
;;  :keymap 'rc/snippet-map
;;  :transiet t)

;; (map!
;;  :leader
;;  :prefix "H"
;;  :desc "Snippet"
;;  :nm "s" #'rc/snippet-mode)
#+end_src

#+RESULTS:
** Code folding
#+begin_src emacs-lisp :tangle yes
(general-def
  :prefix-map 'rc/origami-map
   "c" #'origami-close-node
   "n" #'origami-next-fold
   "p" #'origami-previous-fold
   "f" #'origami-forward-toggle-node
   "a" #'origami-toggle-all-nodes
   "s" #'origami-show-only-node
   )
(hercules-def
 :toggle-funs #'rc/origami-mode
 :keymap 'rc/origami-map
 :transient t)
(map!
:leader
:prefix "H"
:desc "Folding"
:nm "f" #'rc/origami-mode
)
#+end_src

#+RESULTS:
: rc/origami-mode



* Hercules
#+begin_src emacs-lisp :tangle yes

(hercules-def
 :toggle-funs #'rc/magit-map
 :keymap 'magit-mode-map
 :transient t)
(hercules-def
 :toggle-funs #'rc/buffer-mode
 :keymap 'doom-leader-buffer-map
:transient t)

#+end_src

#+RESULTS:
: rc/buffer-mod

#+end_src

* Dired Hercules
#+begin_src emacs-lisp :tangle yes
(general-def
  :prefix-map 'my-dired-map

  "\\" #'dired-do-ispell
  "(" #'dired-hide-details-mode
  ")" #'dired-omit-mode
  "+" #'dired-create-directory
  "=" #'diredp-ediff         ;; smart diff
  "?" #'dired-summary
  "$" #'diredp-hide-subdir-nomove
  "A" #'dired-do-find-regexp
  "C" #'dired-do-copy        ;; Copy all marked files
  "D" #'dired-do-delete
  "E" #'dired-mark-extension
  "e" #'dired-ediff-files
  "F" #'dired-do-find-marked-files
  "G" #'dired-do-chgrp
  "g" #'revert-buffer        ;; read all directories again (refresh)
  "i" #'dired-maybe-insert-subdir
  "l" #'dired-do-redisplay   ;; relist the marked or singel directory
  "M" #'dired-do-chmod
  "m" #'dired-mark
  "O" #'dired-display-file
  "o" #'dired-find-file-other-window
  "Q" #'dired-do-find-regexp-and-replace
  ;; "R" #'dired-do-rename
  ;; "r" #'dired-do-rsynch
  ;; "S" #'dired-do-symlink
  ;; "s" #'dired-sort-toggle-or-edit
  ;; "t" #'dired-toggle-marks
  ;; "U" #'dired-unmark-all-marks
  ;; "u" #'dired-unmark
  ;; "v" #'dired-view-file      ;; q to exit, s to search, = gets line #
  ;; "w" #'dired-kill-subdir
  ;; "Y" #'dired-do-relsymlink
  "z" #'diredp-compress-this-file
  "Z" #'dired-do-compress
  )

(hercules-def
 :toggle-funs #'my-dired-mode
 :keymap 'my-dired-map
 :transient t)

                )
#+end_src
